# name: CI — OS + Python matrix

# on:
#   push:
#   pull_request:

# jobs:
#   build:
#     name: Build (${{ matrix.os }} — py${{ matrix.python-version }})
#     strategy:
#       matrix:
#         python-version: ["3.10", "3.11"]   
#         os: [ubuntu-latest, windows-latest]
#       fail-fast: false                     # allow full matrix to complete for diagnostics
#       max-parallel: 4                      # optional: limit concurrency
#     uses: ./.github/workflows/python-build.yml
#     with:
#       python-version: ${{ matrix.python-version }}
#       runner-os: ${{ matrix.os }}

#     # Each matrix entry will call the reusable workflow with its python-version.

#   # E2E job: runs once after all matrix build runs succeed
#   e2e:
#     needs: build                # waits for ALL matrix build runs to finish successfully
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4
#         # every job gets its own runner; checkout again

#       - name: Set up Python for E2E
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.11"

#       - name: Install deps for E2E
#         run: |
#           python -m pip install --upgrade pip
#           pip install -r requirements.txt

#       - name: Run E2E tests
#         run: pytest tests/e2e -q

#####################



name: Matrix Conditional Example

on:
  push:
  pull_request:

jobs:
  build:
    strategy:
      matrix:
        python-version: ["3.10","3.11"]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Base step
        run: echo "Running basic steps for Python ${{ matrix.python-version }}"

      - name: Lint on 3.11 only
        if: matrix.python-version == '3.11'
        run: |
          echo "Running linter because python-version is ${{ matrix.python-version }}"

      - name: Install the specific requests version and pytest
        run: |
          python -m pip install --upgrade pip
          python -m pip install "requests==${{ matrix.requests-version }}" pytest

      - name: Run tests
        run: pytest -q || true
